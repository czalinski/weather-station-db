services:
  weather-station-db:
    image: ${REGISTRY:-registry.local}/weather-station-db:${VERSION:-latest}
    container_name: weather-station-db
    restart: unless-stopped
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    environment:
      # Data output directory (inside container)
      - DATA_DIR=/app/data
      # Kafka broker (optional - comment out if not using)
      - KAFKA_BOOTSTRAP_SERVERS=${KAFKA_BOOTSTRAP_SERVERS:-}
      # InfluxDB (optional - comment out if not using)
      - INFLUXDB_URL=${INFLUXDB_URL:-}
      - INFLUXDB_TOKEN=${INFLUXDB_TOKEN:-}
      - INFLUXDB_ORG=${INFLUXDB_ORG:-}
      - INFLUXDB_BUCKET=${INFLUXDB_BUCKET:-}
      # Alerting (optional)
      - NTFY_URL=${NTFY_URL:-}
      - NTFY_TOPIC=${NTFY_TOPIC:-}
    # Override default producers if needed (space-separated: "ndbc openmeteo")
    entrypoint: ["/bin/sh", "-c"]
    command: ["weather-station-db --producers ${PRODUCERS:-ndbc openmeteo}"]
    # Resource limits suitable for Orange Pi 5
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M
